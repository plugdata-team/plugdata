#N canvas 503 29 562 578 10;
#X obj 2 428 cnv 3 550 3 empty empty outlets 8 12 0 13 #dcdcdc #000000 0;
#X obj 2 521 cnv 3 550 3 empty empty arguments 8 12 0 13 #dcdcdc #000000 0;
#X obj 89 435 cnv 17 3 17 empty empty 0 5 9 0 16 #dcdcdc #9c9c9c 0;
#X obj 2 266 cnv 3 550 3 empty empty inlets 8 12 0 13 #dcdcdc #000000 0;
#X obj 89 274 cnv 17 3 106 empty empty 0 5 9 0 16 #dcdcdc #9c9c9c 0;
#X obj 297 153 tgl 22 0 empty empty empty 0 -6 0 8 #d0d0d0 #404040 #000000 0 1;
#X obj 89 406 cnv 17 3 17 empty empty 2 5 9 0 16 #dcdcdc #9c9c9c 0;
#X obj 89 456 cnv 17 3 17 empty empty 1 5 9 0 16 #dcdcdc #9c9c9c 0;
#X obj 89 385 cnv 17 3 17 empty empty 1 5 9 0 16 #dcdcdc #9c9c9c 0;
#X obj 2 546 cnv 15 552 21 empty empty empty 20 12 0 14 #e0e0e0 #202020 0;
#X text 157 272 float;
#X text 163 287 list;
#X text 192 386 -;
#X text 156 386 float;
#X text 192 407 -;
#X text 156 407 float;
#X text 192 436 -;
#X text 192 458 -;
#X obj 297 215 nbx 4 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10 #dcdcdc #000000 #000000 0 256;
#X obj 222 215 nbx 4 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10 #dcdcdc #000000 #000000 0 256;
#X obj 172 140 nbx 5 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10 #dcdcdc #000000 #000000 0 256;
#X text 156 436 float;
#X text 156 458 float;
#X text 205 386 the velocity part of a note message;
#X obj 2 480 cnv 3 550 3 empty empty flag 8 12 0 13 #dcdcdc #000000 0;
#X text 157 302 clear - clears the memory (no note-off messages are output);
#X obj 297 238 print velocity;
#X text 193 272 - the pitch part of a note message;
#X obj 308 4 cnv 15 250 40 empty empty empty 12 13 0 18 #7c7c7c #e0e4dc 0;
#X obj 347 11 cnv 10 10 10 empty empty ELSE 0 15 2 30 #7c7c7c #e0e4dc 0;
#X obj 25 40 cnv 4 4 4 empty empty Sustain 0 28 2 18 #e0e0e0 #000000 0;
#X obj 86 40 cnv 4 4 4 empty empty pedal 0 28 2 18 #e0e0e0 #000000 0;
#X obj 460 11 cnv 10 10 10 empty empty EL 0 6 2 13 #7c7c7c #e0e4dc 0;
#X obj 480 11 cnv 10 10 10 empty empty Locus 0 6 2 13 #7c7c7c #e0e4dc 0;
#X obj 517 11 cnv 10 10 10 empty empty Solus' 0 6 2 13 #7c7c7c #e0e4dc 0;
#X obj 466 26 cnv 10 10 10 empty empty ELSE 0 6 2 13 #7c7c7c #e0e4dc 0;
#X obj 504 26 cnv 10 10 10 empty empty library 0 6 2 13 #7c7c7c #e0e4dc 0;
#N canvas 0 22 450 278 (subpatch) 0;
#X coords 0 1 100 -1 252 42 1;
#X restore 307 3 graph;
#X obj 5 4 cnv 15 301 42 empty empty suspedal 20 20 2 37 #e0e0e0 #000000 0;
#N canvas 0 22 450 278 (subpatch) 0;
#X coords 0 1 100 -1 302 42 1;
#X restore 4 3 graph;
#X text 108 332 tonal <float>;
#X text 191 501 -tonal - sets sustain to "tonal" mode;
#X text 102 347 retrig <float>;
#X obj 222 190 else/suspedal;
#X text 96 362 sustain <float>;
#X obj 172 164 makenote 93 750;
#X text 326 157 sustain On/Off;
#X obj 222 238 print pitch;
#X text 70 87 [suspedal] holds MIDI Note Off messages when on and sends them out when it's switched off. It has two sustain modes \, 'regular' (default) and 'tonal' - as in the design of modern pianos., f 63;
#X text 193 287 - a pair of pitch/velocity velues from note messages;
#X text 157 317 flush - outputs all held note-off messages;
#X text 193 332 - non zero sets to "tonal" mode;
#X text 193 347 - sets retrigger mode <0 \, 1 \, 2 or 3>;
#X text 193 362 - pedal switch: on <1> or off <0>;
#X text 207 407 pedal switch: on <1> or off <0>;
#X text 207 436 the pitch value of a note message;
#X text 207 458 the velocity value of a note message;
#X text 157 529 float - non zero turns on the pedal (default: 0 - off);
#N canvas 527 198 822 448 example 0;
#X obj 151 248 ctlin 64 1;
#X obj 151 274 tgl 22 0 empty empty empty 0 -6 0 8 #d0d0d0 #404040 #000000 0 1;
#X obj 657 242 tgl 22 0 empty empty empty 0 -6 0 8 #d0d0d0 #404040 #000000 0 1;
#X text 689 251 On/Off;
#X text 686 234 sustain;
#X obj 76 307 else/suspedal;
#X obj 582 274 else/suspedal;
#X text 38 81 In the example below we have the [else/keyboard] object instead.;
#X obj 76 336 pack float float;
#X obj 76 390 print Note-Message;
#X obj 76 360 else/display;
#X msg 528 224 flush;
#X obj 528 186 bng 25 250 50 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000;
#X obj 481 187 bng 25 250 50 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000;
#X msg 481 225 clear;
#X obj 582 163 nbx 3 14 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10 #dcdcdc #000000 #000000 0 256;
#X obj 582 89 tgl 18 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000 0 1;
#X obj 582 187 makenote 127 250;
#X obj 582 114 else/tempo 40 50;
#X obj 582 208 pack float float;
#X obj 582 235 else/display;
#X text 608 91 random pitches;
#X text 623 162 pitch;
#X obj 582 304 else/voices 2 1;
#N canvas 887 396 225 222 oscillators 0;
#N canvas 358 23 457 381 osc1 0;
#X obj 156 199 *~;
#X obj 58 109 mtof;
#X obj 58 48 inlet;
#X obj 156 312 outlet~;
#X obj 58 80 unpack;
#X obj 171 165 else/adsr~ 150 100 0.5 500;
#X obj 363 304 outlet~;
#X obj 58 144 else/bl.tri~;
#X obj 156 254 else/plate.rev~ 50 0.6 0.25 0.8 0.8;
#X connect 0 0 8 0;
#X connect 1 0 7 0;
#X connect 2 0 4 0;
#X connect 4 0 1 0;
#X connect 4 1 5 0;
#X connect 5 0 0 1;
#X connect 7 0 0 0;
#X connect 8 0 3 0;
#X connect 8 1 6 0;
#X restore 49 103 pd osc1;
#X obj 49 35 inlet;
#N canvas 358 23 457 381 osc2 0;
#X obj 156 199 *~;
#X obj 58 109 mtof;
#X obj 58 48 inlet;
#X obj 156 312 outlet~;
#X obj 58 80 unpack;
#X obj 171 165 else/adsr~ 150 100 0.5 500;
#X obj 363 304 outlet~;
#X obj 58 144 else/bl.tri~;
#X obj 156 254 else/plate.rev~ 50 0.6 0.25 0.8 0.8;
#X connect 0 0 8 0;
#X connect 1 0 7 0;
#X connect 2 0 4 0;
#X connect 4 0 1 0;
#X connect 4 1 5 0;
#X connect 5 0 0 1;
#X connect 7 0 0 0;
#X connect 8 0 3 0;
#X connect 8 1 6 0;
#X restore 108 104 pd osc2;
#X obj 50 172 outlet~;
#X obj 147 175 outlet~;
#X obj 108 36 inlet;
#X connect 0 0 3 0;
#X connect 0 1 4 0;
#X connect 1 0 0 0;
#X connect 2 0 3 0;
#X connect 2 1 4 0;
#X connect 5 0 2 0;
#X restore 582 334 pd oscillators;
#X obj 76 261 else/display;
#X obj 582 138 else/rand.i 60 80;
#X text 37 20 You can directly connect the [notein] object to access MIDI note messages from an external controller and access the MIDI message from an actual sustain pedal (which is normally controller number 64) and feed it to the [suspedal] object.;
#X text 441 20 The default sustain mode - used in this example - holds any note off messages when it is on. Below \, we use [suspedal] in a patch with 2-voice polyphonic synth controlled by random notes. This example uses [voices] but you can also use vanilla's [poly].;
#X obj 580 367 else/out~;
#X obj 29 144 else/keyboard 17 80 3 3 0 0 empty empty;
#X connect 0 0 1 0;
#X connect 1 0 5 2;
#X connect 2 0 6 2;
#X connect 5 0 8 0;
#X connect 5 1 8 1;
#X connect 6 0 23 0;
#X connect 6 1 23 1;
#X connect 8 0 10 0;
#X connect 10 0 9 0;
#X connect 11 0 6 0;
#X connect 12 0 11 0;
#X connect 13 0 14 0;
#X connect 14 0 6 0;
#X connect 15 0 17 0;
#X connect 16 0 18 0;
#X connect 17 0 19 0;
#X connect 17 1 19 1;
#X connect 18 0 26 0;
#X connect 19 0 20 0;
#X connect 20 0 6 0;
#X connect 23 0 24 0;
#X connect 23 1 24 1;
#X connect 24 0 29 0;
#X connect 24 1 29 1;
#X connect 25 0 5 0;
#X connect 26 0 15 0;
#X connect 30 0 25 0;
#X restore 479 188 pd example;
#N canvas 615 107 492 467 retrigger 0;
#X obj 46 185 vradio 15 1 0 4 empty empty empty 0 -8 0 10 #dcdcdc #000000 #000000 0;
#X floatatom 46 252 3 0 0 0 - - - 0;
#X obj 129 354 pack float float;
#X obj 175 178 keyboard 17 80 1 3 0 0 empty empty;
#X obj 129 274 else/display;
#X obj 129 421 print retrigger;
#X text 33 52 - mode <0>:;
#X text 33 68 - mode <1>:;
#X text 33 84 - mode <2>:;
#X text 33 115 - mode <3>:;
#X msg 46 274 retrig \$1;
#X obj 204 292 tgl 17 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000 0 1;
#X text 107 52 do not retrigger (ignores repeated notes), f 59;
#X text 22 13 [suspedal] has 4 different modes of handling repeated notes. These are for either 'regular' or 'tonal' modes \, and they are:, f 62;
#X text 107 68 retrigger a repeated note on message, f 59;
#X obj 129 318 else/suspedal;
#X text 64 184 0 'ignore', f 14;
#X text 64 214 2 'free first';
#X text 64 229 3 'free later';
#X text 64 199 1 'retrigger', f 14;
#X text 107 84 'free first' - sends a note off before retriggering a repeated note, f 59;
#X text 336 305 see also:;
#X obj 357 328 else/voices;
#X obj 364 356 else/adsr~;
#X text 332 381 The above objects interact well with [suspedal] and its retrigger modes., f 18;
#X obj 129 384 else/display;
#X text 107 112 'free later' - keeps a history of all received Note-Ons and sends note off messages for all of them when the pedal is switched off (unlike mode 1 \, which only sends one not off);
#X connect 0 0 1 0;
#X connect 1 0 10 0;
#X connect 2 0 25 0;
#X connect 3 0 4 0;
#X connect 4 0 15 0;
#X connect 10 0 15 0;
#X connect 11 0 15 2;
#X connect 15 0 2 0;
#X connect 15 1 2 1;
#X connect 25 0 5 0;
#X restore 467 234 pd retrigger;
#N canvas 738 145 513 478 tonal 0;
#X obj 110 215 tgl 15 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000 0 127;
#X obj 227 289 tgl 20 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000 0 1;
#X msg 110 237 30 \$1;
#X text 34 172 3) turn off note;
#X obj 110 287 else/display;
#X text 274 299 turn off sustain to send the note off from the held note, f 26;
#X obj 110 362 else/mono;
#X obj 110 392 else/display;
#X obj 161 393 else/display;
#X text 166 153 4) play with keyboard (new notes aren't sustained);
#X text 34 156 1) turn on note;
#X text 34 189 5) retrigger note;
#X text 254 299 6);
#X text 255 285 2) turn on sustain (tonal mode);
#X obj 337 386 else/mono;
#X text 315 362 see also:;
#X text 52 19 In the 'tonal' mode \, as in the design of piano sustain pedals \, you can sustain notes that are currently on but not the new ones after you switch it on., f 62;
#X text 52 63 This allows you to sustain a bass/chord while being able to use both hands to play further notes. This is useful for [poly] or [voices] \, but also [mono]., f 62;
#X obj 179 184 else/keyboard 17 80 2 3 0 0 empty empty;
#X obj 110 322 else/suspedal -tonal -retrig 1, f 20;
#X connect 0 0 2 0;
#X connect 1 0 19 2;
#X connect 2 0 4 0;
#X connect 4 0 19 0;
#X connect 6 0 7 0;
#X connect 6 1 8 0;
#X connect 18 0 4 0;
#X connect 19 0 6 0;
#X connect 19 1 6 1;
#X restore 491 211 pd tonal;
#X text 149 485 -retrig <float> - sets retriger mode <0 \, 1 \, 2 or 3> (default 0), f 63;
#X connect 5 0 43 2;
#X connect 18 0 26 0;
#X connect 19 0 47 0;
#X connect 20 0 45 0;
#X connect 43 0 19 0;
#X connect 43 1 18 0;
#X connect 45 0 43 0;
#X connect 45 1 43 1;
